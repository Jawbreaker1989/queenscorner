<div class="contenedor">
  <div *ngIf="loading" class="loading">
    <div class="spinner"></div>
    <p>Cargando factura...</p>
  </div>

  <div *ngIf="error && !loading" class="error">
    <span class="icon">âš ï¸</span>
    {{ error }}
  </div>

  <div *ngIf="factura && !loading" class="contenido-factura">
    <div class="header">
      <div class="header-content">
        <h1>ğŸ“„ Factura {{ factura.numeroFactura }}</h1>
        <p class="subtitle">{{ factura.nombreCliente }}</p>
      </div>
      <div class="header-actions">
        <button class="btn btn-secondary" (click)="volver()">
          â† Volver
        </button>
      </div>
    </div>

    <div class="contenido">
      <!-- Info General & Estado -->
      <div class="info-grid">
        <div class="info-box">
          <h3>ğŸ“‹ InformaciÃ³n General</h3>
          <div class="info-row">
            <span class="label">NÃºmero Factura:</span>
            <span class="value codigo">{{ factura.numeroFactura }}</span>
          </div>
          <div class="info-row">
            <span class="label">Fecha EmisiÃ³n:</span>
            <span class="value">{{ factura.fechaEmision | date:'dd/MM/yyyy' }}</span>
          </div>
          <div class="info-row">
            <span class="label">Fecha Vencimiento:</span>
            <span class="value">{{ factura.fechaVencimiento | date:'dd/MM/yyyy' }}</span>
          </div>
          <div class="info-row">
            <span class="label">Estado:</span>
            <span [ngClass]="getEstadoColor(factura.estado)" class="badge">
              {{ factura.estado }}
            </span>
          </div>
        </div>

        <div class="info-box">
          <h3>ğŸ‘¤ InformaciÃ³n Cliente</h3>
          <div class="info-row">
            <span class="label">RazÃ³n Social:</span>
            <span class="value">{{ factura.nombreCliente }}</span>
          </div>
          <div class="info-row">
            <span class="label">RUT:</span>
            <span class="value">{{ factura.rutCliente }}</span>
          </div>
          <div class="info-row">
            <span class="label">Email:</span>
            <span class="value">{{ factura.emailCliente }}</span>
          </div>
          <div class="info-row">
            <span class="label">TelÃ©fono:</span>
            <span class="value">{{ factura.telefonoCliente }}</span>
          </div>
        </div>
      </div>

      <!-- Medio de Pago -->
      <div class="info-box">
        <h3>ğŸ’³ Medio de Pago</h3>
        <div class="info-row">
          <span class="label">Tipo:</span>
          <span class="value">{{ factura.medioPago }}</span>
        </div>
        <div *ngIf="factura.referenciaPago" class="info-row">
          <span class="label">Referencia:</span>
          <span class="value">{{ factura.referenciaPago }}</span>
        </div>
      </div>

      <!-- LÃ­neas de Factura -->
      <div class="lineas-section">
        <h3>ğŸ“¦ LÃ­neas de Factura</h3>
        <div class="tabla-contenedor">
          <table class="tabla">
            <thead>
              <tr>
                <th>#</th>
                <th>DescripciÃ³n</th>
                <th>Cantidad</th>
                <th>V. Unitario</th>
                <th>Total</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let linea of factura.lineas">
                <td class="numero">{{ linea.numeroLinea }}</td>
                <td class="descripcion">{{ linea.descripcion }}</td>
                <td class="cantidad">{{ linea.cantidad }}</td>
                <td class="monto">${{ linea.valorUnitario | number: '1.2-2' }}</td>
                <td class="monto-total">${{ linea.valorLinea | number: '1.2-2' }}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Totales -->
      <div class="totales-section">
        <h3>ğŸ’° Totales</h3>
        <div class="total-item">
          <span class="label">Anticipo:</span>
          <span class="value">${{ factura.anticipo | number: '1.2-2' }}</span>
        </div>
        <div class="total-item">
          <span class="label">Subtotal:</span>
          <span class="value">${{ factura.subtotalItems | number: '1.2-2' }}</span>
        </div>
        <div class="total-item">
          <span class="label">Base Gravable:</span>
          <span class="value">${{ factura.baseGravable | number: '1.2-2' }}</span>
        </div>
        <div class="total-item">
          <span class="label">IVA 19%:</span>
          <span class="value">${{ factura.iva19 | number: '1.2-2' }}</span>
        </div>
        <div class="total-item total">
          <span class="label">TOTAL A PAGAR:</span>
          <span class="value">${{ factura.totalAPagar | number: '1.2-2' }}</span>
        </div>
      </div>

      <!-- Notas -->
      <div *ngIf="factura.notas" class="info-box">
        <h3>ğŸ“ Notas</h3>
        <p class="notas">{{ factura.notas }}</p>
      </div>

      <!-- Condiciones de Pago -->
      <div *ngIf="factura.condicionesPago" class="info-box">
        <h3>ğŸ“‹ Condiciones de Pago</h3>
        <p class="condiciones">{{ factura.condicionesPago }}</p>
      </div>

      <!-- Acciones -->
      <div class="acciones-footer">
        <button class="btn btn-secondary" (click)="volver()">
          â† Volver
        </button>
        <button *ngIf="factura.rutaPdf" class="btn btn-descargar" (click)="descargarPdf()">
          ğŸ“¥ Descargar PDF
        </button>
        <button *ngIf="factura.estado === 'EN_REVISION'" class="btn btn-emitir" (click)="emitirFactura()">
          ğŸ“¤ Emitir Factura
        </button>
      </div>
    </div>
  </div>
</div>
