<div class="contenedor">
  <div *ngIf="loading" class="loading">
    <div class="spinner"></div>
    <p>Cargando factura...</p>
  </div>

  <div *ngIf="error && !loading" class="error">
    <span class="icon">âš ï¸</span>
    {{ error }}
  </div>

  <div *ngIf="factura && !loading" class="contenido-factura">
    <div class="header">
      <div class="header-content">
        <h1>ğŸ“„ Factura {{ factura.numeroFactura }}</h1>
        <p class="subtitle">{{ factura.nombreCliente || factura.negocio?.cliente?.nombre }}</p>
      </div>
      <div class="header-actions">
        <button class="btn btn-secondary" (click)="volver()">
          â† Volver
        </button>
      </div>
    </div>

    <div class="contenido">
      <!-- Info General & Estado -->
      <div class="info-grid">
        <div class="info-box">
          <h3>ğŸ“‹ InformaciÃ³n General</h3>
          <div class="info-row">
            <span class="label">NÃºmero Factura:</span>
            <span class="value codigo">{{ factura.numeroFactura }}</span>
          </div>
          <div class="info-row">
            <span class="label">Fecha EmisiÃ³n:</span>
            <span class="value">{{ (factura.fechaCreacion || factura.fechaEmision) | date: 'dd/MM/yyyy' }}</span>
          </div>
          <div class="info-row">
            <span class="label">Estado:</span>
            <span [ngClass]="getEstadoColor(factura.estado)" class="badge">
              {{ getEstadoLabel(factura.estado) }}
            </span>
          </div>
        </div>

        <div class="info-box">
          <h3>ğŸ‘¤ InformaciÃ³n Cliente</h3>
          <div class="info-row">
            <span class="label">Nombre:</span>
            <span class="value">{{ factura.nombreCliente || factura.negocio?.cliente?.nombre }}</span>
          </div>
          <div class="info-row">
            <span class="label">Email:</span>
            <span class="value">{{ factura.emailCliente || factura.negocio?.cliente?.email || 'N/A' }}</span>
          </div>
          <div class="info-row">
            <span class="label">TelÃ©fono:</span>
            <span class="value">{{ factura.telefonoCliente || factura.negocio?.cliente?.telefono || 'N/A' }}</span>
          </div>
          <div class="info-row">
            <span class="label">DirecciÃ³n:</span>
            <span class="value">{{ factura.negocio?.cliente?.direccion || 'N/A' }}</span>
          </div>
        </div>
      </div>

      <!-- InformaciÃ³n del Negocio -->
      <div class="info-box">
        <h3>ğŸ’¼ InformaciÃ³n del Negocio</h3>
        <div class="info-row">
          <span class="label">Negocio:</span>
          <span class="value">{{ factura.nombreNegocio || factura.negocio?.numero }}</span>
        </div>
        <div class="info-row">
          <span class="label">Total CotizaciÃ³n:</span>
          <span class="value">${{ factura.negocio?.totalCotizacion | number: '1.2-2' }}</span>
        </div>
      </div>

      <!-- LÃ­neas de Factura -->
      <div class="lineas-section">
        <h3>ğŸ“¦ LÃ­neas de Factura</h3>
        <div *ngIf="!factura.lineas || factura.lineas.length === 0" class="empty-state">
          <p>No hay lÃ­neas registradas en esta factura</p>
        </div>
        <div *ngIf="factura.lineas && factura.lineas.length > 0" class="tabla-contenedor">
          <table class="tabla">
            <thead>
              <tr>
                <th>#</th>
                <th>DescripciÃ³n</th>
                <th>Cantidad</th>
                <th>V. Unitario</th>
                <th>Total LÃ­nea</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let linea of factura.lineas">
                <td class="numero">{{ linea.numeroLinea }}</td>
                <td class="descripcion">{{ linea.descripcion }}</td>
                <td class="cantidad">{{ linea.cantidad }}</td>
                <td class="monto">${{ linea.valorUnitario | number: '1.2-2' }}</td>
                <td class="monto-total"><strong>${{ linea.total | number: '1.2-2' }}</strong></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Resumen de Pagos y Totales -->
      <div class="resumen-pagos-section">
        <div class="resumen-box">
          <h3>ğŸ’° Resumen de Pagos</h3>
          
          <div class="payment-summary">
            <div class="payment-item anticipo">
              <span class="label">Anticipo Pagado:</span>
              <span class="value">${{ factura.anticipo | number: '1.2-2' }}</span>
            </div>

            <div class="divider"></div>

            <div class="payment-item subtotal">
              <span class="label">Subtotal Factura:</span>
              <span class="value">${{ (factura.subtotalItems || factura.subtotal) | number: '1.2-2' }}</span>
            </div>

            <div class="payment-item impuestos">
              <span class="label">Impuestos (IVA 19%):</span>
              <span class="value">${{ (factura.iva19 || factura.iva) | number: '1.2-2' }}</span>
            </div>

            <div class="divider-thick"></div>

            <div class="payment-item total-pagar">
              <span class="label">TOTAL A PAGAR:</span>
              <span class="value total"><strong>${{ (factura.totalAPagar || factura.total) | number: '1.2-2' }}</strong></span>
            </div>

            <div class="divider"></div>

            <div class="payment-item saldo">
              <span class="label">Saldo Pendiente:</span>
              <span class="value pendiente">${{ (factura.saldoPendiente || (factura.totalAPagar - factura.anticipo)) | number: '1.2-2' }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Notas -->
      <div *ngIf="factura.notas" class="info-box">
        <h3>ğŸ“ Notas</h3>
        <p class="notas">{{ factura.notas }}</p>
      </div>

      <!-- Condiciones de Pago -->
      <div *ngIf="factura.condicionesPago" class="info-box">
        <h3>ğŸ“‹ Condiciones de Pago</h3>
        <p class="condiciones">{{ factura.condicionesPago }}</p>
      </div>

      <!-- Acciones -->
      <div class="acciones-footer">
        <div class="acciones-left">
          <button class="btn btn-secondary" (click)="volver()">
            â† Volver
          </button>
        </div>
        <div class="acciones-right">
          <button class="btn btn-primary" (click)="iraDashboard()">
            ğŸ“Š Ir a Dashboard
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
