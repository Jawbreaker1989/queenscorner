<div class="form-container" *ngIf="!cargando; else loadingTemplate">
  <div class="form-card">
    <h1>‚úèÔ∏è Editar Negocio</h1>
    <p class="subtitle">Modifique los datos del negocio {{ negocio?.codigo }}</p>

    <div *ngIf="negocio" class="formulario">
      <!-- SECCI√ìN 1: INFORMACI√ìN DE COTIZACI√ìN (READ-ONLY) -->
      <div class="seccion read-only-section">
        <div class="section-header">
          <h3>üìù COTIZACI√ìN ORIGEN</h3>
          <span class="info-label">(Informaci√≥n de referencia)</span>
        </div>

        <div class="info-grid">
          <div class="info-item">
            <label>C√≥digo Cotizaci√≥n</label>
            <p>{{ negocio.codigoCotizacion }}</p>
          </div>
          <div class="info-item">
            <label>Cliente</label>
            <p>{{ negocio.cliente?.nombre }}</p>
          </div>
          <div class="info-item">
            <label>Total Cotizaci√≥n</label>
            <p class="monto">${{ negocio.totalCotizacion | number:'1.2-2' }}</p>
          </div>
          <div class="info-item">
            <label>Fecha Cotizaci√≥n</label>
            <p>{{ formatearFecha(negocio.fechaCotizacion) }}</p>
          </div>
        </div>
      </div>

      <!-- SECCI√ìN 2: DATOS DEL NEGOCIO (EDITABLES) -->
      <div class="seccion editable-section">
        <div class="section-header">
          <h3>üíº DATOS DEL NEGOCIO</h3>
          <span class="info-label">(Modifique seg√∫n sea necesario)</span>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="fechaInicio">Fecha Inicio *</label>
            <input type="date" 
                   id="fechaInicio" 
                   [(ngModel)]="negocioForm.fechaInicio" 
                   name="fechaInicio"
                   [disabled]="procesando" />
          </div>

          <div class="form-group">
            <label for="fechaFinEstimada">Fecha Fin Estimada *</label>
            <input type="date" 
                   id="fechaFinEstimada" 
                   [(ngModel)]="negocioForm.fechaFinEstimada" 
                   name="fechaFinEstimada"
                   [disabled]="procesando" />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="presupuestoAsignado">Presupuesto Asignado</label>
            <input type="number" 
                   id="presupuestoAsignado" 
                   [(ngModel)]="negocioForm.presupuestoAsignado" 
                   name="presupuestoAsignado"
                   placeholder="Monto del presupuesto asignado"
                   step="0.01"
                   min="0"
                   [disabled]="procesando" />
            <small>Presupuesto disponible para el negocio</small>
          </div>

          <div class="form-group">
            <label for="anticipo">Anticipo Otorgado</label>
            <input type="number" 
                   id="anticipo" 
                   [(ngModel)]="negocioForm.anticipo" 
                   name="anticipo"
                   step="0.01"
                   min="0"
                   placeholder="Monto del anticipo recibido"
                   [disabled]="procesando" />
            <small>Anticipo recibido por la cotizaci√≥n aprobada</small>
          </div>

          <div class="form-group">
            <label for="saldoPendiente">Saldo Pendiente</label>
            <input type="number" 
                   id="saldoPendiente" 
                   [value]="negocio.saldoPendiente || 0"
                   name="saldoPendiente"
                   step="0.01"
                   disabled
                   readonly />
            <small>Monto pendiente (total cotizaci√≥n - anticipo)</small>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="responsable">Responsable</label>
            <input type="text" 
                   id="responsable" 
                   [(ngModel)]="negocioForm.responsable" 
                   name="responsable"
                   placeholder="Nombre del responsable"
                   [disabled]="procesando" />
          </div>
        </div>

        <div class="form-group">
          <label for="descripcion">Descripci√≥n del Negocio *</label>
          <textarea id="descripcion" 
                    [(ngModel)]="negocioForm.descripcion" 
                    name="descripcion"
                    placeholder="Describa el negocio y sus actividades"
                    rows="4"
                    [disabled]="procesando"></textarea>
          <small>Esta informaci√≥n documenta el prop√≥sito y alcance del negocio</small>
        </div>

        <div class="form-group">
          <label for="observaciones">Observaciones</label>
          <textarea id="observaciones" 
                    [(ngModel)]="negocioForm.observaciones" 
                    name="observaciones"
                    placeholder="Agregue observaciones o notas adicionales (opcional)"
                    rows="3"
                    [disabled]="procesando"></textarea>
        </div>
      </div>

      <!-- ACCIONES -->
      <div class="form-actions">
        <button class="btn btn-secondary" (click)="cancelar()" [disabled]="procesando">
          Cancelar
        </button>
        <button class="btn btn-primary" (click)="guardar()" [disabled]="procesando">
          {{ procesando ? '‚è≥ Guardando...' : '‚úì Guardar Cambios' }}
        </button>
      </div>
    </div>
  </div>
</div>

<ng-template #loadingTemplate>
  <div class="loading-center">
    <div class="spinner"></div>
    <p>Cargando negocio...</p>
  </div>
</ng-template>
