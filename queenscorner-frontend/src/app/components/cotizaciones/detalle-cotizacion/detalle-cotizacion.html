<div class="detalle-container">
  <div class="detalle-header">
    <div class="header-content">
      <h1>Detalle de Cotizaci√≥n</h1>
      <p class="subtitle">Ver y gestionar cotizaci√≥n</p>
    </div>
    <div class="header-actions">
      <button class="btn btn-negocio" (click)="crearNegocio()" [disabled]="!cotizacion || cotizacion.estado !== 'APROBADA' || loading" [title]="cotizacion && cotizacion.estado !== 'APROBADA' ? 'Solo disponible para APROBADAS' : 'Crear Negocio'">
        üíº Crear Negocio
      </button>
      <button class="btn btn-pdf" (click)="generarPdf()" [disabled]="!cotizacion || cotizacion.estado !== 'APROBADA' || loading || pdfGenerando || pdfGenerado" [title]="pdfGenerado ? 'PDF ya generado' : pdfGenerando ? 'Generando PDF...' : cotizacion && cotizacion.estado !== 'APROBADA' ? 'Solo disponible para APROBADAS' : 'Generar PDF'">
        üìÑ Generar PDF
      </button>
      <button class="btn btn-primary" (click)="editar()" [disabled]="!cotizacion || (cotizacion.estado !== 'BORRADOR' && cotizacion.estado !== 'ENVIADA') || loading" [title]="cotizacion && cotizacion.estado !== 'BORRADOR' && cotizacion.estado !== 'ENVIADA' ? 'Solo se puede editar en BORRADOR o ENVIADA' : 'Editar'">
        ‚úèÔ∏è Editar
      </button>
      <button class="btn btn-secondary" (click)="volver()">
        ‚Üê Volver
      </button>
    </div>
  </div>

  <div class="contenido">
    <div *ngIf="loading" class="loading">
      <div class="spinner"></div>
      <p>Cargando cotizaci√≥n...</p>
    </div>

    <div *ngIf="error && !loading" class="error">
      <span class="icon">‚ö†Ô∏è</span>
      {{ error }}
    </div>

    <div *ngIf="cotizacion && !loading" class="cotizacion-card">
      <!-- Estado y C√≥digo -->
      <div class="info-section destacado">
        <div class="info-item">
          <label>C√≥digo</label>
          <p class="codigo">{{ cotizacion.codigo }}</p>
        </div>
        <div class="info-item">
          <label>Estado</label>
          <p>
            <span [ngClass]="getEstadoColor(cotizacion.estado)" class="badge">
              {{ cotizacion.estado }}
            </span>
          </p>
        </div>
        <div class="info-item">
          <label>Cliente</label>
          <p class="cliente">{{ cotizacion.cliente.nombre }}</p>
        </div>
      </div>

      <!-- Informaci√≥n General -->
      <div class="info-section">
        <h2>Informaci√≥n General</h2>
        <div class="info-grid">
          <div class="info-item">
            <label>Descripci√≥n</label>
            <p>{{ cotizacion.descripcion }}</p>
          </div>
          <div class="info-item">
            <label>Fecha Creaci√≥n</label>
            <p>{{ cotizacion.fechaCreacion | date: 'dd/MM/yyyy HH:mm' }}</p>
          </div>
          <div class="info-item">
            <label>Fecha Validez</label>
            <p>{{ cotizacion.fechaValidez }}</p>
          </div>
          <div class="info-item" *ngIf="cotizacion.observaciones">
            <label>Observaciones</label>
            <p>{{ cotizacion.observaciones }}</p>
          </div>
        </div>
      </div>

      <!-- Items -->
      <div class="info-section">
        <h2>Items de Cotizaci√≥n</h2>
        <div class="items-table">
          <table>
            <thead>
              <tr>
                <th>Descripci√≥n</th>
                <th>Cantidad</th>
                <th>Precio Unit.</th>
                <th>Subtotal</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let item of cotizacion.items">
                <td>{{ item.descripcion }}</td>
                <td class="center">{{ item.cantidad }}</td>
                <td class="right">${{ item.precioUnitario | number: '1.2-2' }}</td>
                <td class="right">${{ item.subtotal | number: '1.2-2' }}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Totales -->
      <div class="info-section totales">
        <div class="total-item">
          <label>Subtotal:</label>
          <span>${{ cotizacion.subtotal | number: '1.2-2' }}</span>
        </div>
        <div class="total-item">
          <label>Impuestos:</label>
          <span>${{ cotizacion.impuestos | number: '1.2-2' }}</span>
        </div>
        <div class="total-item grande">
          <label>Total:</label>
          <span>${{ cotizacion.total | number: '1.2-2' }}</span>
        </div>
      </div>

      <!-- Cambiar Estado -->
      <div class="cambiar-estado" *ngIf="cotizacion.estado === 'BORRADOR'">
        <h3>Cambiar Estado</h3>
        <div class="estado-controls">
          <select [(ngModel)]="nuevoEstado" [disabled]="cambiandoEstado">
            <option [value]="null">Selecciona nuevo estado</option>
            <option *ngFor="let estado of estados" [value]="estado">
              {{ estado }}
            </option>
          </select>
          <button class="btn btn-primary" (click)="cambiarEstado()" [disabled]="!nuevoEstado || cambiandoEstado">
            {{ cambiandoEstado ? 'Actualizando...' : 'Actualizar Estado' }}
          </button>
        </div>
        <div class="estado-info">
          <p>üì± <strong>ENVIADA:</strong> EL CLIENTE HA SIDO NOTIFICADO</p>
          <p>‚úÖ <strong>APROBADA:</strong> LISTA PARA EJECUTAR NEGOCIO</p>
          <p>‚ùå <strong>RECHAZADA:</strong> EL CLIENTE NO ESTA DEACUERDO CON LO ESTIPULADO</p>
        </div>
      </div>
    </div>
  </div>
</div>
