<div class="cotizaciones-container">
  <div class="cotizaciones-header">
    <div class="header-content">
      <h1>GestiÃ³n de Cotizaciones</h1>
      <p class="subtitle">Crea y administra cotizaciones para tus clientes</p>
    </div>
    <div class="header-actions">
      <button class="btn btn-primary" (click)="crear()" [disabled]="loading">
        + Nueva CotizaciÃ³n
      </button>
      <button class="btn btn-secondary" (click)="volver()">
        â† Volver
      </button>
    </div>
  </div>

  <div class="search-container">
    <input
      type="text"
      class="search-input"
      [(ngModel)]="searchTerm"
      (input)="filtrarCotizaciones()"
      placeholder="Buscar por cÃ³digo, cliente, estado o descripciÃ³n..."
    />
  </div>

  <div class="mensajes">
    <div class="error" *ngIf="error">
      <span class="icon">âš ï¸</span>
      {{ error }}
    </div>
    <div class="exito" *ngIf="mensajeExito">
      <span class="icon">âœ“</span>
      {{ mensajeExito }}
    </div>
  </div>

  <div class="contenido">
    <div *ngIf="loading" class="loading">
      <div class="spinner"></div>
      <p>Cargando cotizaciones...</p>
    </div>

    <div *ngIf="!loading && cotizacionesFiltradas.length === 0 && cotizaciones.length > 0" class="sin-datos">
      <p>No se encontraron cotizaciones que coincidan con tu bÃºsqueda</p>
      <p class="info-busqueda">Intenta con otros tÃ©rminos o <button class="btn-link" (click)="searchTerm = ''; filtrarCotizaciones()">limpia la bÃºsqueda</button></p>
    </div>

    <div *ngIf="!loading && cotizaciones.length === 0" class="sin-datos">
      <p>No hay cotizaciones registradas</p>
      <button class="btn btn-primary" (click)="crear()">Crear primera cotizaciÃ³n</button>
    </div>

    <div *ngIf="!loading && cotizacionesFiltradas.length > 0" class="tabla-wrapper">
      <table class="tabla-cotizaciones">
        <thead>
          <tr>
            <th>CÃ³digo</th>
            <th>Cliente</th>
            <th>Total</th>
            <th>Estado</th>
            <th>Validez</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let cot of cotizacionesFiltradas" class="fila-cotizacion" (dblclick)="verDobleClick(cot.id)">
            <td class="codigo">{{ cot.codigo }}</td>
            <td class="cliente">{{ cot.cliente.nombre }}</td>
            <td class="total">${{ cot.total | number: '1.2-2' }}</td>
            <td class="estado">
              <span [ngClass]="getEstadoColor(cot.estado)" class="badge">{{ cot.estado }}</span>
            </td>
            <td class="validez">{{ cot.fechaValidez }}</td>
            <td class="acciones">
              <button class="btn-icon btn-info" (click)="ver(cot.id)" title="Ver">ğŸ‘ï¸</button>
              <button class="btn-icon btn-warning" (click)="editar(cot.id)" [disabled]="cot.estado !== 'BORRADOR' && cot.estado !== 'ENVIADA'" [title]="cot.estado !== 'BORRADOR' && cot.estado !== 'ENVIADA' ? 'Solo se puede editar en BORRADOR o ENVIADA' : 'Editar'">âœï¸</button>
              <div class="pdf-action-container">
                <button class="btn-icon btn-pdf" (click)="generarPdf(cot.id)" [disabled]="pdfGenerando[cot.id] || pdfGenerados[cot.id] || cot.estado !== 'APROBADA'" [title]="pdfGenerados[cot.id] ? 'PDF ya generado' : cot.estado !== 'APROBADA' ? 'Solo disponible para APROBADAS' : 'Generar PDF'">ğŸ“„</button>
                <span *ngIf="pdfGenerando[cot.id]" class="pdf-loading-spinner" title="Generando PDF..."></span>
              </div>
              <button class="btn-icon btn-danger" (click)="eliminar(cot.id, cot.codigo)" title="Ocultar de la lista">ğŸ‘ï¸â€ğŸ—¨ï¸</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
